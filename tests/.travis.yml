---
language: python
python: "2.7"

before_install:
        - sudo apt-get update -qq

install:
        - pip install ansible

        - "printf '[defaults]\nroles_path = ../' > ansible.cfg"

script:
        # Check role systax
        - ansible-playbook -i tests/inventory tests/test.yml --syntax-check
        # Run role with ansible-playbook
        - ansible-playbook -i tests/inventory tests/test.yml --connection=local
        # Test role idempotence
        - ansible-playbook -i tests/inventory tests/test.yml --connection=local | grep -q 'change=0.*failed=0' && (echo 'Idempontence test: pass' && exit 0) || (echo 'Idempotence test: fail' && exit 1)
